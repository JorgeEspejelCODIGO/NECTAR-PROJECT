<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jorge Alberto Espejel Padilla">

<title>Preliminary-result</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Preliminary-results_files/libs/clipboard/clipboard.min.js"></script>
<script src="Preliminary-results_files/libs/quarto-html/quarto.js"></script>
<script src="Preliminary-results_files/libs/quarto-html/popper.min.js"></script>
<script src="Preliminary-results_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Preliminary-results_files/libs/quarto-html/anchor.min.js"></script>
<link href="Preliminary-results_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Preliminary-results_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Preliminary-results_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Preliminary-results_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Preliminary-results_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Preliminary-result</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jorge Alberto Espejel Padilla </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="title" class="level1">
<h1>1. Title</h1>
<p>Analysis of the data set from the project “The nectar report: quantitative review of nectar sugar concentrations offered by bee visited flowers in agricultural and non-agricultural landscapes”</p>
</section>
<section id="team-members-names" class="level1">
<h1>2. Team Members Names</h1>
<ul>
<li>Jorge Alberto Espejel Padilla</li>
<li>Mehedi Shariff</li>
<li>Amala Thomas</li>
<li>Ei Mon Than</li>
</ul>
</section>
<section id="introduction" class="level1">
<h1>3. Introduction</h1>
<p><strong>Introduction</strong></p>
<p>Nectar is a critical resource in plant-pollinator interactions, influencing pollinator behavior, visitation rates, and plant reproductive success. Its sugar composition—primarily sucrose, glucose, and fructose—serves as a key determinant of nectar quality and pollinator preference (Nicolson &amp; Thornburg, 2007). Variations in nectar sugar concentration have been linked to ecological, evolutionary, and environmental factors, including plant taxonomy, geographical region, and climate conditions (Pacini &amp; Nepi, 2007; Ornelas et al., 2019). Understanding these variations is crucial for elucidating the role of nectar traits in shaping plant-pollinator dynamics.Taxonomy plays a significant role in determining nectar composition. Differences in sugar ratios have been observed at both the family and genus levels, with phylogenetic constraints often influencing nectar traits (Perret et al., 2001; Chalcoff et al., 2006). For example, hummingbird-pollinated flowers tend to produce sucrose-dominant nectars, while bee-pollinated flowers show balanced sugar proportions (Rodríguez-Gironés &amp; Santamaría, 2004; Nicolson &amp; Thornburg, 2007). These variations highlight evolutionary adaptations to pollinator syndromes. In addition to taxonomy, geographic factors contribute to variability in nectar traits. Nectar sugar concentration has been shown to vary across regions, likely as a response to climatic factors such as temperature, rainfall, and latitude (Pacini &amp; Nepi, 2007; Stiles &amp; Freeman, 1993). For instance, studies in temperate and tropical regions have reported regional differences in nectar sugar concentration, influenced by both plant phylogeny and environmental conditions (Petanidou, 2005; Chalcoff et al., 2006). These findings underscore the interplay between evolutionary processes and environmental pressures in shaping nectar characteristics globally. Recent work, such as Ornelas et al.&nbsp;(2019), has revealed significant variation in nectar sugar concentration across families, genera, and continents, reflecting both fixed effects (taxonomic constraints) and random effects (environmental variability). Identifying these patterns is essential for understanding how nectar traits evolve and adapt in different ecological and climatic contexts. This study aims to analyze the variability in nectar sugar concentration across taxonomic levels and geographical regions. Specifically, we investigate: (1) differences in mean nectar sugar concentration between continents, (2) significant pairwise comparisons at family and genus levels, and (3) the distribution of random effects within taxonomic families. By addressing these objectives, the study contributes to a broader understanding of how nectar traits influence pollination ecology in a changing global environment.</p>
</section>
<section id="objectives-and-hypotheses" class="level1">
<h1>4. Objectives and Hypotheses</h1>
<section id="objectives" class="level2">
<h2 class="anchored" data-anchor-id="objectives">Objectives</h2>
<p><strong>Primary Objective</strong>:</p>
<p>To investigate the relationships between plant taxonomy (e.g., family, genus), geography and nectar sugar concentration.</p>
<p><strong>Secondary Objective</strong></p>
<p>To analyze sugar concentration variability within high-performing families and identify key genera.</p>
</section>
<section id="hypotheses" class="level2">
<h2 class="anchored" data-anchor-id="hypotheses">Hypotheses</h2>
<p><strong>Primary Hypothesis</strong>:</p>
<p><strong>H₀ (Null Hypothesis)</strong>: There is no significant relationship between plant taxonomy (family, genus) and nectar sugar concentration.</p>
<p><strong>H₁ (Alternative Hypothesis)</strong>: Plant taxonomy significantly affects nectar sugar concentration.</p>
<p><strong>Secondary Hypotheses</strong>:</p>
<p><strong>Geographical Variation</strong>:</p>
<p><strong>H₀</strong>: Nectar sugar concentration does not vary significantly across geographical regions (continents or hemispheres).</p>
<p><strong>H₁</strong>: Nectar sugar concentration varies significantly across geographical regions.</p>
<p><strong>Taxonomic Contribution</strong>:</p>
<p><strong>H₀</strong>: Within high-performing families, genera do not significantly differ in their contributions to higher average sugar concentrations.</p>
<p><strong>H₁</strong>: Certain genera within high-performing families significantly drive higher average sugar concentrations.</p>
</section>
</section>
<section id="methods" class="level1">
<h1>5. Methods</h1>
<hr>
<section id="summary-statistics" class="level3">
<h3 class="anchored" data-anchor-id="summary-statistics">1. <strong>Summary Statistics</strong>:</h3>
<ul>
<li><p><strong>Objective</strong>: Summarize nectar sugar concentration by Family, Genus, and Region.</p></li>
<li><p><strong>Analyses</strong>:</p>
<ul>
<li>Grouped data by <strong>Family</strong>, <strong>Genus</strong>, and <strong>Region</strong> to compute:
<ul>
<li><strong>Mean</strong>: To determine average sugar concentration.</li>
<li><strong>Median</strong>: To measure central tendency, reducing outlier effects.</li>
<li><strong>Range</strong>: To understand variability in sugar concentration.</li>
<li><strong>Standard Deviation (SD)</strong>: To quantify data spread.</li>
<li><strong>Interquartile Range (IQR)</strong>: To capture variability while ignoring extreme values.</li>
</ul></li>
<li>Visualized the mean sugar concentration by Family and Region using barplots.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="kruskal-wallis-test-for-taxonomic-effects" class="level3">
<h3 class="anchored" data-anchor-id="kruskal-wallis-test-for-taxonomic-effects">2. <strong>Kruskal-Wallis Test for Taxonomic Effects</strong>:</h3>
<ul>
<li><p><strong>Objective</strong>: Evaluate the relationship between taxonomy and nectar sugar concentration.</p></li>
<li><p><strong>Analyses</strong>:</p>
<ul>
<li>Conducted <strong>Kruskal-Wallis tests</strong> for sugar concentration across:
<ul>
<li><strong>Families</strong> and <strong>Genera</strong> to detect significant differences.</li>
</ul></li>
<li>Visualized results with a heatmap highlighting significant p-values for Family and Genus comparisons.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="pairwise-comparisons-with-dunns-test" class="level3">
<h3 class="anchored" data-anchor-id="pairwise-comparisons-with-dunns-test">3. <strong>Pairwise Comparisons with Dunn’s Test</strong>:</h3>
<ul>
<li><p><strong>Objective</strong>: Identify pairwise differences in nectar sugar concentration.</p></li>
<li><p><strong>Analyses</strong>:</p>
<ul>
<li>Performed <strong>Dunn’s test</strong> for pairwise comparisons at both:
<ul>
<li><strong>Family</strong> and <strong>Genus</strong> levels.</li>
</ul></li>
<li>Adjusted p-values using the <strong>Bonferroni correction</strong>.</li>
<li>Highlighted significant pairwise comparisons in barplots.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="linear-mixed-effects-model" class="level3">
<h3 class="anchored" data-anchor-id="linear-mixed-effects-model">4. <strong>Linear Mixed-Effects Model</strong>:</h3>
<ul>
<li><p><strong>Objective</strong>: Assess variability in nectar sugar concentration within and across Families and Genera.</p></li>
<li><p><strong>Analyses</strong>:</p>
<ul>
<li>Fitted a <strong>linear mixed-effects model</strong>:
<ul>
<li>Included <strong>Genus nested within Family</strong> as random effects.</li>
</ul></li>
<li>Examined fixed and random effects.</li>
<li>Visualized random effects using histograms and barplots for top/bottom genera.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="geographical-effects-on-sugar-concentration" class="level3">
<h3 class="anchored" data-anchor-id="geographical-effects-on-sugar-concentration">5. <strong>Geographical Effects on Sugar Concentration</strong>:</h3>
<ul>
<li><p><strong>Objective</strong>: Explore geographical variability in nectar sugar concentration.</p></li>
<li><p><strong>Analyses</strong>:</p>
<ul>
<li>Tested sugar concentration across continents using:
<ul>
<li><strong>ANOVA</strong> (if data were normal) or <strong>Kruskal-Wallis</strong> (if non-normal).</li>
</ul></li>
<li>Visualized results with boxplots and geospatial maps highlighting mean sugar concentration per region.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="ecological-effects-crops-vs.-weeds" class="level3">
<h3 class="anchored" data-anchor-id="ecological-effects-crops-vs.-weeds">6. <strong>Ecological Effects (Crops vs.&nbsp;Weeds)</strong>:</h3>
<ul>
<li><p><strong>Objective</strong>: Compare sugar concentration between crops and weeds.</p></li>
<li><p><strong>Analyses</strong>:</p>
<ul>
<li>Created <strong>boxplots</strong> to visualize differences between plant types.</li>
<li>Used <strong>Kruskal-Wallis tests</strong> to test for significant differences.</li>
<li>Performed <strong>Dunn’s test</strong> for pairwise comparisons between plant types.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="high-performing-families" class="level3">
<h3 class="anchored" data-anchor-id="high-performing-families">7. <strong>High-Performing Families</strong>:</h3>
<ul>
<li><p><strong>Objective</strong>: Analyze sugar concentration variability within families with high average values.</p></li>
<li><p><strong>Analyses</strong>:</p>
<ul>
<li>Identified families with <strong>mean sugar concentration &gt; 55%</strong>.</li>
<li>Conducted <strong>ANOVA</strong> to evaluate differences among genera within these families.</li>
<li>Visualized variability using boxplots.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="phylogenetic-analysis" class="level3">
<h3 class="anchored" data-anchor-id="phylogenetic-analysis">8. <strong>Phylogenetic Analysis</strong>:</h3>
<ul>
<li><p><strong>Objective</strong>: Assess evolutionary patterns in nectar sugar concentration.</p></li>
<li><p><strong>Analyses</strong>:</p>
<ul>
<li>Matched Family names with Open Tree of Life identifiers.</li>
<li>Constructed a <strong>phylogenetic tree</strong> and tested for <strong>phylogenetic signal</strong>.</li>
<li>Mapped sugar concentration as a heatmap on the tree.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="heatmap-of-sugar-concentration-by-family" class="level3">
<h3 class="anchored" data-anchor-id="heatmap-of-sugar-concentration-by-family">9. <strong>Heatmap of Sugar Concentration by Family</strong>:</h3>
<ul>
<li><p><strong>Objective</strong>: Visualize sugar concentration aligned with phylogenetic tree order.</p></li>
<li><p><strong>Analyses</strong>:</p>
<ul>
<li>Aligned Family order from the phylogenetic tree.</li>
<li>Mapped mean sugar concentration using a heatmap.</li>
<li>Adjusted visualization for improved readability.</li>
</ul></li>
</ul>
<hr>
</section>
</section>
<section id="results" class="level1">
<h1>6. Results</h1>
<section id="summary-statistics-1" class="level4">
<h4 class="anchored" data-anchor-id="summary-statistics-1">1.&nbsp;<strong>Summary Statistics</strong></h4>
<p>The descriptive analysis summarized nectar sugar concentration across families, genera, and geographical regions. Results indicate significant variability in sugar concentrations:</p>
<ul>
<li><p>Mean nectar sugar concentrations ranged between&nbsp;<strong>40% and 65%</strong>, depending on family and region.</p></li>
<li><p>Families like&nbsp;<strong>Asteraceae</strong>,&nbsp;<strong>Fabaceae</strong>, and&nbsp;<strong>Zygophyllaceae</strong>&nbsp;showed higher average concentrations across most regions.</p></li>
<li><p>Geographical regions, demonstrated similar trends with some variability across families.</p></li>
</ul>
<p><strong>Figure 1</strong>: Mean nectar sugar concentration (%) by Family and Region.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 418 × 8
   Family    Genus Region mean_sugar median_sugar range_sugar sd_sugar iqr_sugar
   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
 1 Alstroem… Alst… austr…       40           40           0      NA         0   
 2 Alstroem… Alst… europe       40           40           0      NA         0   
 3 Alstroem… Alst… north…       40           40           0      NA         0   
 4 Alstroem… Alst… south…       40           40           0      NA         0   
 5 Amarylli… Alli… africa       59.8         58.4        15.2     6.57      6.27
 6 Amarylli… Alli… asia         59.8         58.4        15.2     6.57      6.27
 7 Amarylli… Alli… austr…       59.8         58.4        15.2     6.57      6.27
 8 Amarylli… Alli… europe       59.8         58.4        15.2     6.57      6.27
 9 Amarylli… Alli… north…       59.8         58.4        15.2     6.57      6.27
10 Amarylli… Alli… south…       59.8         58.4        15.2     6.57      6.27
# ℹ 408 more rows</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Preliminary-results_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="taxonomic-effects-on-nectar-sugar-concentration" class="level4">
<h4 class="anchored" data-anchor-id="taxonomic-effects-on-nectar-sugar-concentration"><strong>2. Taxonomic Effects on Nectar Sugar Concentration</strong></h4>
<p>The Kruskal-Wallis test revealed that significant differences in nectar sugar concentration are primarily observed at the&nbsp;<strong>Genus level</strong>.</p>
<ul>
<li><p><strong>Genus level</strong>: Genera such as&nbsp;<strong>Aesculus</strong>&nbsp;and&nbsp;<strong>Adesmia</strong>&nbsp;exhibited the most notable differences, as reflected in their&nbsp;<strong>low adjusted p-values</strong>&nbsp;(Figure 2), confirming statistically significant differences.</p></li>
<li><p><strong>Family level</strong>: The top 5 largest p-values indicate&nbsp;<strong>non-significant differences</strong>, suggesting less distinct variation in sugar concentrations between families (Figure 2).</p></li>
</ul>
<p>This highlights that variability in nectar sugar concentration is more pronounced within genera rather than across broader family classifications.</p>
</section>
<section id="pairwise-comparisons-analysis" class="level4">
<h4 class="anchored" data-anchor-id="pairwise-comparisons-analysis">3. Pairwise Comparisons Analysis:</h4>
<ul>
<li><p><strong>Family level</strong>: Significant pairwise differences were observed in specific family pairs such as&nbsp;<strong>Brassicaceae - Solanaceae</strong>&nbsp;and&nbsp;<strong>Asteraceae - Brassicaceae</strong>&nbsp;(Figure 3). These families showed distinct differences in sugar concentration values.</p></li>
<li><p><strong>Genus level</strong>: At the genus level,&nbsp;<strong>Adesmia - Ribes</strong>&nbsp;and&nbsp;<strong>Aconitum - Pyrus</strong>&nbsp;showed the most significant pairwise differences (Figure 4). This emphasizes greater variation in nectar sugar concentration between genera compared to families.</p></li>
</ul>
<p><strong>Figure 2</strong>: Top 5 smallest and largest p-values for taxonomic effects.<br>
<strong>Figure 3 and 4</strong>: Significant pairwise comparisons at the Family and Genus level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure sugar concentration is numeric and missing data is handled</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>bee_data <span class="ot">&lt;-</span> bee_data <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Family), <span class="sc">!</span><span class="fu">is.na</span>(Genus), <span class="sc">!</span><span class="fu">is.na</span>(sugar_concentration)) <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sugar_concentration =</span> <span class="fu">as.numeric</span>(sugar_concentration))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Kruskal-Wallis test for nectar sugar concentration by Family</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>kw_family_taxonomy <span class="ot">&lt;-</span> bee_data <span class="sc">%&gt;%</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Family) <span class="sc">%&gt;%</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_value =</span> <span class="fu">tryCatch</span>(</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">kruskal.test</span>(sugar_concentration <span class="sc">~</span> Family, <span class="at">data =</span> bee_data)<span class="sc">$</span>p.value,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>  <span class="co"># Handle errors by assigning NA</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value))  <span class="co"># Remove rows with NA p-values</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Kruskal-Wallis test for nectar sugar concentration by Genus</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>kw_genus_taxonomy <span class="ot">&lt;-</span> bee_data <span class="sc">%&gt;%</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Genus) <span class="sc">%&gt;%</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_value =</span> <span class="fu">tryCatch</span>(</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">kruskal.test</span>(sugar_concentration <span class="sc">~</span> Genus, <span class="at">data =</span> bee_data)<span class="sc">$</span>p.value,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>  <span class="co"># Handle errors by assigning NA</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value))  <span class="co"># Remove rows with NA p-values</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine Family and Genus results</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>kw_taxonomy_results <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  kw_family_taxonomy <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Level =</span> <span class="st">"Family"</span>),</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  kw_genus_taxonomy <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Level =</span> <span class="st">"Genus"</span>)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure unique identifiers for visualization</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>kw_taxonomy_results <span class="ot">&lt;-</span> kw_taxonomy_results <span class="sc">%&gt;%</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">Identifier =</span> <span class="fu">ifelse</span>(Level <span class="sc">==</span> <span class="st">"Family"</span>, <span class="fu">paste</span>(Family, <span class="st">"Family"</span>), <span class="fu">paste</span>(Genus, <span class="st">"Genus"</span>))</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter top 5 smallest and largest p-values dynamically</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>kw_taxonomy_filtered <span class="ot">&lt;-</span> kw_taxonomy_results <span class="sc">%&gt;%</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(p_value) <span class="sc">%&gt;%</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, (<span class="fu">n</span>() <span class="sc">-</span> <span class="dv">4</span>)<span class="sc">:</span><span class="fu">n</span>()))  <span class="co"># Select top 5 smallest and largest p-values</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure there are results to plot</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(kw_taxonomy_filtered) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the heatmap for taxonomic effects</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(kw_taxonomy_filtered, <span class="fu">aes</span>(<span class="at">x =</span> Level, <span class="at">y =</span> Identifier, <span class="at">fill =</span> p_value)) <span class="sc">+</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">high =</span> <span class="st">"red"</span>, <span class="at">name =</span> <span class="st">"p-value"</span>, <span class="at">na.value =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Top 5 Smallest and Largest P-Values: Taxonomic Effects on Nectar Sugar Concentration"</span>,</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Taxonomic Level"</span>,</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Family or Genus"</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"No significant results to display."</span>)</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Preliminary-results_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Dunn's Test for Pairwise Comparisons at the Family Level</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>dunn_family <span class="ot">&lt;-</span> <span class="fu">dunnTest</span>(sugar_concentration <span class="sc">~</span> Family, <span class="at">data =</span> bee_data, <span class="at">method =</span> <span class="st">"bonferroni"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>dunn_family_results <span class="ot">&lt;-</span> dunn_family<span class="sc">$</span>res</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check column names of the Dunn test results</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">names</span>(dunn_family_results))  <span class="co"># Debugging step to confirm column names</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Comparison" "Z"          "P.unadj"    "P.adj"     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract significant comparisons for Family level</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>significant_family <span class="ot">&lt;-</span> dunn_family_results <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">comparison =</span> Comparison  <span class="co"># Use 'Comparison' column directly</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(P.adj <span class="sc">&lt;</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(P.adj)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant Pairwise Comparisons Between Families:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Significant Pairwise Comparisons Between Families:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(significant_family)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Comparison         Z      P.unadj        P.adj
1     Brassicacae - Rosaceae  5.045638 4.520100e-07 0.0004474899
2    Salicaceae - Solanaceae  4.516266 6.293950e-06 0.0062310101
3        Fabaceae - Rosaceae  4.408675 1.040048e-05 0.0102964798
4 Ranunculaceae - Solanaceae  4.332437 1.474680e-05 0.0145993318
5   Ranunculaceae - Rosaceae  4.270960 1.946337e-05 0.0192687379
6   Asteraceae - Brassicacae -4.165322 3.109136e-05 0.0307804420
7   Brassicacae - Solanaceae  4.154158 3.264870e-05 0.0323222108
                  comparison
1     Brassicacae - Rosaceae
2    Salicaceae - Solanaceae
3        Fabaceae - Rosaceae
4 Ranunculaceae - Solanaceae
5   Ranunculaceae - Rosaceae
6   Asteraceae - Brassicacae
7   Brassicacae - Solanaceae</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Dunn's Test for Pairwise Comparisons at the Genus Level</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>dunn_genus <span class="ot">&lt;-</span> <span class="fu">dunnTest</span>(sugar_concentration <span class="sc">~</span> Genus, <span class="at">data =</span> bee_data, <span class="at">method =</span> <span class="st">"bonferroni"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>dunn_genus_results <span class="ot">&lt;-</span> dunn_genus<span class="sc">$</span>res</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract significant comparisons for Genus level</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>significant_genus <span class="ot">&lt;-</span> dunn_genus_results <span class="sc">%&gt;%</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">comparison =</span> Comparison  <span class="co"># Use 'Comparison' column directly</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(P.adj <span class="sc">&lt;</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(P.adj)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant Pairwise Comparisons Between Genera:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Significant Pairwise Comparisons Between Genera:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(significant_genus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Comparison         Z      P.unadj        P.adj
1  Adesmia - Helianthus  5.909836 3.424480e-09 2.128657e-05
2      Adesmia - Prunus  5.552575 2.814921e-08 1.749755e-04
3    Adesmia - Capsicum  5.120430 3.048390e-07 1.894879e-03
4       Adesmia - Pyrus  5.074027 3.894832e-07 2.421027e-03
5   Adesmia - Sinningia  5.063801 4.109793e-07 2.554648e-03
6       Adesmia - Rubus  5.040302 4.647986e-07 2.889188e-03
7     Aconitum - Prunus  4.726900 2.279738e-06 1.417085e-02
8   Aconitum - Capsicum  4.628692 3.679818e-06 2.287375e-02
9    Adesmia - Fragaria  4.613489 3.959650e-06 2.461318e-02
10     Capsicum - Salix -4.516266 6.293950e-06 3.912319e-02
11     Aconitum - Pyrus  4.506512 6.590201e-06 4.096469e-02
12      Adesmia - Ribes  4.471218 7.777524e-06 4.834509e-02
             comparison
1  Adesmia - Helianthus
2      Adesmia - Prunus
3    Adesmia - Capsicum
4       Adesmia - Pyrus
5   Adesmia - Sinningia
6       Adesmia - Rubus
7     Aconitum - Prunus
8   Aconitum - Capsicum
9    Adesmia - Fragaria
10     Capsicum - Salix
11     Aconitum - Pyrus
12      Adesmia - Ribes</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize Results: Top Significant Comparisons at Family Level</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(significant_family, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(comparison, P.adj), <span class="at">y =</span> P.adj)) <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Significant Pairwise Comparisons: Family Level"</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Family Pair"</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Adjusted P-Value"</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Preliminary-results_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize Results: Top Significant Comparisons at Genus Level</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(significant_genus, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(comparison, P.adj), <span class="at">y =</span> P.adj)) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Significant Pairwise Comparisons: Genus Level"</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Genus Pair"</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Adjusted P-Value"</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Preliminary-results_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div></li>
</ul>
</section>
<section id="random-effects" class="level4">
<h4 class="anchored" data-anchor-id="random-effects"><strong>4. Random Effects</strong></h4>
<p>The random effects analysis using a&nbsp;<strong>linear mixed-effects model</strong>&nbsp;assessed the variability in nectar sugar concentration among&nbsp;<strong>genera nested within families</strong>.</p>
<ol type="1">
<li><p><strong>Distribution of Random Effects</strong>&nbsp;(Figure 5):</p>
<ul>
<li><p>A&nbsp;<strong>broad distribution</strong>&nbsp;of random effect estimates was observed, ranging from strongly negative to strongly positive values.</p></li>
<li><p>The shape of the distribution highlights&nbsp;<strong>substantial variability</strong>&nbsp;among genera within families, with most estimates concentrated around zero, indicating moderate deviations from the overall mean.</p></li>
<li><p>Genera with highly negative or positive random effects reflect strong deviations, suggesting that sugar concentration varies significantly across specific taxa.</p></li>
</ul></li>
<li><p><strong>Top and Bottom Random Effects</strong>&nbsp;(Figure 6):</p>
<ul>
<li><p>The&nbsp;<strong>top 10 genera</strong>&nbsp;with positive random effects included taxa such as&nbsp;<strong>Salicaceae</strong>&nbsp;and&nbsp;<strong>Lamiaceae</strong>, indicating that these genera contribute significantly higher nectar sugar concentrations compared to the family-level average.</p></li>
<li><p>Conversely, genera like&nbsp;<strong>Rosaceae</strong>&nbsp;and&nbsp;<strong>Solanaceae</strong>&nbsp;were among the&nbsp;<strong>bottom 10</strong>, exhibiting highly negative random effect estimates, reflecting lower nectar sugar concentrations than their respective family means.</p></li>
<li><p>This variability underscores that specific genera within families drive significant differences in nectar sugar concentration, rather than the family as a whole.</p></li>
</ul></li>
</ol>
<p><strong>Figure 5</strong>: Distribution of Random Effects: genera Within families<br>
<strong>Figure 6</strong>: Top and Bottom 10 random effects estimates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert necessary columns to factors</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>bee_data<span class="sc">$</span>Family <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(bee_data<span class="sc">$</span>Family)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>bee_data<span class="sc">$</span>Genus <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(bee_data<span class="sc">$</span>Genus)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows with missing sugar concentration</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>bee_data <span class="ot">&lt;-</span> bee_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(sugar_concentration))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the Linear Mixed-Effects Model</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Model: Sugar concentration ~ (1 | Family/Genus) for random effects</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>lmm_model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(sugar_concentration <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Family<span class="sc">/</span>Genus), <span class="at">data =</span> bee_data)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># View the summary of the model</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmm_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: sugar_concentration ~ 1 + (1 | Family/Genus)
   Data: bee_data

REML criterion at convergence: 3348.3

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.3270 -0.6219 -0.1030  0.4343  3.2359 

Random effects:
 Groups       Name        Variance Std.Dev.
 Genus:Family (Intercept) 108.685  10.425  
 Family       (Intercept)   4.803   2.192  
 Residual                  78.458   8.858  
Number of obs: 444, groups:  Genus:Family, 116; Family, 45

Fixed effects:
            Estimate Std. Error t value
(Intercept)    40.94       1.28   31.98</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and Filter Random Effects</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract random effects (Genus within Family)</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>random_effects <span class="ot">&lt;-</span> <span class="fu">ranef</span>(lmm_model)<span class="sc">$</span><span class="st">`</span><span class="at">Genus:Family</span><span class="st">`</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>random_effects_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(random_effects)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(random_effects_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Random_Effect"</span>)  <span class="co"># Rename the random effects column</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Genus:Family identifiers for clarity</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>random_effects_df<span class="sc">$</span>Genus_Family <span class="ot">&lt;-</span> <span class="fu">rownames</span>(random_effects)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Split Family and Genus into separate columns</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>random_effects_df <span class="ot">&lt;-</span> random_effects_df <span class="sc">%&gt;%</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Genus_Family, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"Family"</span>, <span class="st">"Genus"</span>), <span class="at">sep =</span> <span class="st">":"</span>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange and select the top 10 and bottom 10 random effects</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>random_effects_filtered <span class="ot">&lt;-</span> random_effects_df <span class="sc">%&gt;%</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Random_Effect))) <span class="sc">%&gt;%</span>  <span class="co"># Sort by absolute value</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, (<span class="fu">n</span>() <span class="sc">-</span> <span class="dv">9</span>)<span class="sc">:</span><span class="fu">n</span>()))  <span class="co"># Select top 10 and bottom 10</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize Random Effects</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Histogram of Random Effects</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(random_effects_df, <span class="fu">aes</span>(<span class="at">x =</span> Random_Effect)) <span class="sc">+</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Random Effects: Genera within Families"</span>,</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Random Effect Estimate"</span>,</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Count"</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Preliminary-results_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Barplot for Top/Bottom 10 Random Effects</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(random_effects_filtered, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_reorder</span>(Genus, Random_Effect), <span class="at">y =</span> Random_Effect, <span class="at">fill =</span> Family)) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top and Bottom 10 Random Effects Estimates"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Genus (Family)"</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Random Effect Estimate"</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Family"</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Preliminary-results_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geographical-effects-on-nectar-sugar-concentration-and-geospatial-mappnig" class="level4">
<h4 class="anchored" data-anchor-id="geographical-effects-on-nectar-sugar-concentration-and-geospatial-mappnig">5. <strong>Geographical Effects on Nectar Sugar Concentration and Geospatial Mappnig</strong></h4>
<p>Regional comparisons of nectar sugar concentration were conducted using&nbsp;<strong>ANOVA</strong>. The results demonstrated&nbsp;<strong>no significant differences</strong>&nbsp;in nectar sugar concentrations across geographical regions.</p>
<ul>
<li><p>The&nbsp;<strong>median sugar concentration</strong>&nbsp;remained consistent across all regions, ranging between&nbsp;<strong>35% and 45%</strong>.</p></li>
<li><p><strong>Variability</strong>&nbsp;within regions, as shown by the spread of the boxplots, was similar, with a few outliers observed across all continents (Figure 8).</p></li>
<li><p>Regions such as&nbsp;<strong>North America</strong>&nbsp;and&nbsp;<strong>South America</strong>&nbsp;displayed slightly wider interquartile ranges (IQRs), suggesting a modestly higher spread of sugar concentration values compared to other regions (Figure 8).</p></li>
</ul>
<p>Overall, these findings suggest that geographical location does not play a substantial role in driving differences in nectar sugar concentration.</p>
<p><strong>Figure 7</strong>: Boxplots of nectar sugar concentration across geographical regions</p>
<p><strong>Figure 8</strong>: Geospatial mappnig</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Data Preparation</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert geographical regions into factors</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>bee_data_long <span class="ot">&lt;-</span> bee_data <span class="sc">%&gt;%</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">"Region"</span>, <span class="at">value =</span> <span class="st">"Presence"</span>, europe<span class="sc">:</span>australia) <span class="sc">%&gt;%</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Presence <span class="sc">==</span> <span class="st">"yes"</span>) <span class="sc">%&gt;%</span>  <span class="co"># Keep only relevant rows</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Region =</span> <span class="fu">factor</span>(Region))  <span class="co"># Convert Region to factor</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the structure of the data</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(bee_data_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1977 obs. of  12 variables:
 $ number             : int  1 2 3 4 5 6 7 8 9 10 ...
 $ Family             : Factor w/ 45 levels "","Alstroemeriaceae",..: 34 12 12 34 8 17 34 26 17 34 ...
 $ Genus              : Factor w/ 112 levels "","Acer","Aconitum",..: 64 85 19 91 104 73 82 106 107 91 ...
 $ species            : chr  "domestica" "raphanistrum" "sp" "idaeus" ...
 $ sci_name           : chr  "Malus sp." "Raphanus raphanistrum" "Brassica sp" "Rubus idaeus" ...
 $ variant            : chr  "" "" "" "" ...
 $ sugar_concentration: num  42 40 39 37 34 34 33 31 30 28 ...
 $ type               : chr  "crop" "weed" "crop" "crop" ...
 $ reference          : chr  "Butler, C. G. (1945). The influence of various physical and biological factors of the environment on honeybee a"| __truncated__ "Butler, C. G. (1945). The influence of various physical and biological factors of the environment on honeybee a"| __truncated__ "Butler, C. G. (1945). The influence of various physical and biological factors of the environment on honeybee a"| __truncated__ "Butler, C. G. (1945). The influence of various physical and biological factors of the environment on honeybee a"| __truncated__ ...
 $ notes              : chr  "" "" "" "" ...
 $ Region             : Factor w/ 6 levels "africa","asia",..: 4 4 4 4 4 4 4 4 4 4 ...
 $ Presence           : chr  "yes" "yes" "yes" "yes" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Normality Check (Shapiro-Wilk)</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Test for normality of sugar concentration</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>shapiro_test <span class="ot">&lt;-</span> <span class="fu">shapiro.test</span>(bee_data_long<span class="sc">$</span>sugar_concentration)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(shapiro_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  bee_data_long$sugar_concentration
W = 0.96827, p-value &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Select Appropriate Test: ANOVA or Kruskal-Wallis</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (shapiro_test<span class="sc">$</span>p.value <span class="sc">&gt;</span> <span class="fl">0.05</span>) {</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Data is approximately normal. Proceeding with ANOVA...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ANOVA: Compare sugar concentration across Regions</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  anova_result <span class="ot">&lt;-</span> <span class="fu">aov</span>(sugar_concentration <span class="sc">~</span> Region, <span class="at">data =</span> bee_data_long)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">summary</span>(anova_result))</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tukey's Post-Hoc Test</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  tukey_result <span class="ot">&lt;-</span> <span class="fu">TukeyHSD</span>(anova_result)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tukey_result)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Visualization: Boxplot for ANOVA</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(bee_data_long, <span class="fu">aes</span>(<span class="at">x =</span> Region, <span class="at">y =</span> sugar_concentration, <span class="at">fill =</span> Region)) <span class="sc">+</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Nectar Sugar Concentration Across Geographical Regions"</span>,</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Region"</span>,</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Sugar Concentration (%)"</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Data is not normal. Proceeding with Kruskal-Wallis test...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Kruskal-Wallis Test</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>  kruskal_result <span class="ot">&lt;-</span> <span class="fu">kruskal.test</span>(sugar_concentration <span class="sc">~</span> Region, <span class="at">data =</span> bee_data_long)</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(kruskal_result)</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pairwise Dunn's Test for Post-Hoc Comparisons</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>  dunn_result <span class="ot">&lt;-</span> <span class="fu">dunnTest</span>(sugar_concentration <span class="sc">~</span> Region, <span class="at">data =</span> bee_data_long, <span class="at">method =</span> <span class="st">"bonferroni"</span>)</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(dunn_result)</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Visualization: Boxplot for Kruskal-Wallis</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(bee_data_long, <span class="fu">aes</span>(<span class="at">x =</span> Region, <span class="at">y =</span> sugar_concentration, <span class="at">fill =</span> Region)) <span class="sc">+</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Nectar Sugar Concentration Across Geographical Regions"</span>,</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Region"</span>,</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Sugar Concentration (%)"</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data is not normal. Proceeding with Kruskal-Wallis test...

    Kruskal-Wallis rank sum test

data:  sugar_concentration by Region
Kruskal-Wallis chi-squared = 1.0451, df = 5, p-value = 0.9588</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                      Comparison           Z   P.unadj P.adj
1                  africa - asia  0.20717119 0.8358762     1
2             africa - australia  0.28897620 0.7725996     1
3               asia - australia  0.08607713 0.9314051     1
4                africa - europe  0.61516139 0.5384481     1
5                  asia - europe  0.42003203 0.6744621     1
6             australia - europe  0.32961098 0.7416939     1
7         africa - north_america -0.02853842 0.9772327     1
8           asia - north_america -0.24911640 0.8032707     1
9      australia - north_america -0.33536627 0.7373488     1
10        europe - north_america -0.68333139 0.4943975     1
11        africa - south_america -0.27219087 0.7854753     1
12          asia - south_america -0.50128328 0.6161718     1
13     australia - south_america -0.58556120 0.5581704     1
14        europe - south_america -0.93859856 0.3479369     1
15 north_america - south_america -0.25872766 0.7958454     1</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Preliminary-results_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Data Preparation</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check unique values in region columns (assuming presence columns)</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>bee_data <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(africa, asia, australia, europe, north_america, south_america) <span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(<span class="sc">~</span> <span class="fu">unique</span>(.))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  africa asia australia europe north_america south_america
1    yes  yes       yes    yes           yes           yes
2                                                         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape the dataset to long format</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>bee_data_long <span class="ot">&lt;-</span> bee_data <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">"Region"</span>, <span class="at">value =</span> <span class="st">"Presence"</span>, africa, asia, australia, europe, north_america, south_america) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Presence <span class="sc">==</span> <span class="st">"yes"</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(sugar_concentration))  <span class="co"># Only "yes" and non-NA sugar concentrations</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Mean, SD, and N for each region</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>continent_summary <span class="ot">&lt;-</span> bee_data_long <span class="sc">%&gt;%</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mean =</span> <span class="fu">round</span>(<span class="fu">mean</span>(sugar_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">SD =</span> <span class="fu">round</span>(<span class="fu">sd</span>(sugar_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="fu">n</span>()</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(N <span class="sc">&gt;</span> <span class="dv">0</span>)  <span class="co"># Filter regions with at least one valid sample</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(continent_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  Region         Mean    SD     N
  &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
1 africa         38.9  11.0   282
2 asia           38.7  10.9   325
3 australia      38.6  11.1   317
4 europe         38.4  11.7   351
5 north_america  38.9  11.7   354
6 south_america  39.1  11.4   348</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># World map data</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume `continent_summary` has Mean, SD, and N for each region</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The coordinates for each continent should be pre-defined (example coordinates below)</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>continent_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Region =</span> <span class="fu">c</span>(<span class="st">"africa"</span>, <span class="st">"asia"</span>, <span class="st">"australia"</span>, <span class="st">"europe"</span>, <span class="st">"north_america"</span>, <span class="st">"south_america"</span>),</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean =</span> <span class="fu">c</span>(<span class="fl">38.93</span>, <span class="fl">38.70</span>, <span class="fl">38.63</span>, <span class="fl">38.41</span>, <span class="fl">38.90</span>, <span class="fl">39.11</span>),</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">SD =</span> <span class="fu">c</span>(<span class="fl">11.02</span>, <span class="fl">10.94</span>, <span class="fl">11.07</span>, <span class="fl">11.69</span>, <span class="fl">11.67</span>, <span class="fl">11.35</span>),</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">c</span>(<span class="dv">282</span>, <span class="dv">325</span>, <span class="dv">317</span>, <span class="dv">351</span>, <span class="dv">354</span>, <span class="dv">348</span>),</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">lon =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">90</span>, <span class="dv">135</span>, <span class="dv">10</span>, <span class="sc">-</span><span class="dv">100</span>, <span class="sc">-</span><span class="dv">60</span>),  <span class="co"># Longitude for continent centers</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">lat =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="sc">-</span><span class="dv">25</span>, <span class="dv">55</span>, <span class="dv">50</span>, <span class="sc">-</span><span class="dv">15</span>)     <span class="co"># Latitude for continent centers</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Load world map</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Data frame with coordinates, means, SD, and sample sizes</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>continent_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">Region =</span> <span class="fu">c</span>(<span class="st">"africa"</span>, <span class="st">"asia"</span>, <span class="st">"australia"</span>, <span class="st">"europe"</span>, <span class="st">"north_america"</span>, <span class="st">"south_america"</span>),</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean =</span> <span class="fu">c</span>(<span class="fl">38.93</span>, <span class="fl">38.70</span>, <span class="fl">38.63</span>, <span class="fl">38.41</span>, <span class="fl">38.90</span>, <span class="fl">39.11</span>),</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">SD =</span> <span class="fu">c</span>(<span class="fl">11.02</span>, <span class="fl">10.94</span>, <span class="fl">11.07</span>, <span class="fl">11.69</span>, <span class="fl">11.67</span>, <span class="fl">11.35</span>),</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">c</span>(<span class="dv">282</span>, <span class="dv">325</span>, <span class="dv">317</span>, <span class="dv">351</span>, <span class="dv">354</span>, <span class="dv">348</span>),</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">lon =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">90</span>, <span class="dv">135</span>, <span class="dv">10</span>, <span class="sc">-</span><span class="dv">100</span>, <span class="sc">-</span><span class="dv">60</span>),  <span class="co"># Longitude for continent centers</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">lat =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="sc">-</span><span class="dv">25</span>, <span class="dv">55</span>, <span class="dv">50</span>, <span class="sc">-</span><span class="dv">15</span>)     <span class="co"># Latitude for continent centers</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust position slightly upwards for text</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>continent_summary <span class="ot">&lt;-</span> continent_summary <span class="sc">%&gt;%</span></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text_lat =</span> lat <span class="sc">+</span> <span class="dv">8</span>)  <span class="co"># Move text up by 8 latitude units</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the map with aligned text above each continent</span></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Base world map</span></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Points on the map for each continent</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> continent_summary, <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">size =</span> N, <span class="at">color =</span> Mean), <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">low =</span> <span class="st">"yellow"</span>, <span class="at">high =</span> <span class="st">"purple"</span>, <span class="at">name =</span> <span class="st">"Mean Sugar (%)"</span>) <span class="sc">+</span></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">12</span>), <span class="at">name =</span> <span class="st">"Sample Size"</span>) <span class="sc">+</span></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add text with N, Mean, and SD above the points</span></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> continent_summary, <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> text_lat, </span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"N = "</span>, N, <span class="st">"</span><span class="sc">\n</span><span class="st">Mean = "</span>, Mean, <span class="st">"</span><span class="sc">\n</span><span class="st">SD = "</span>, SD)),</span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">2</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Titles and theme</span></span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Sugar Concentration by Continent"</span>,</span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Mean and SD of nectar sugar concentration (%)"</span></span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_blank</span>()</span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Preliminary-results_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ecological-effects-crops-vs-weeds-vs-wilds" class="level4">
<h4 class="anchored" data-anchor-id="ecological-effects-crops-vs-weeds-vs-wilds">6. Ecological Effects (Crops vs Weeds vs Wilds)</h4>
<p>The comparison of nectar sugar concentrations among&nbsp;<strong>crops</strong>,&nbsp;<strong>weeds</strong>, and&nbsp;<strong>wild plants</strong>&nbsp;revealed distinct patterns:</p>
<ul>
<li><p><strong>Wild plants</strong>&nbsp;exhibited the&nbsp;<strong>highest median sugar concentrations</strong>, exceeding&nbsp;<strong>45%</strong>, with a wider interquartile range and more variability compared to the other plant types.</p></li>
<li><p><strong>Crops</strong>&nbsp;displayed the lowest sugar concentrations, with a median around&nbsp;<strong>35%</strong>&nbsp;and a narrower spread.</p></li>
<li><p><strong>Weeds</strong>&nbsp;showed intermediate sugar concentrations, with a median close to&nbsp;<strong>40%</strong>, overlapping slightly with crops but lower than wild plants.</p></li>
</ul>
<p>Pairwise comparisons using&nbsp;<strong>Dunn’s test</strong>&nbsp;identified a&nbsp;<strong>significant difference</strong>&nbsp;between&nbsp;<strong>wild plants and crops</strong>, while no significant differences were observed between crops and weeds or weeds and wild plants (Figure 9).</p>
<p>These results suggest that wild plants may provide nectar with higher sugar concentrations compared to cultivated crops, possibly reflecting ecological adaptations.</p>
<p><strong>Figure 9: Ecological Effects ( Crops vs Weeds vs Wilds)</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Boxplot: Compare sugar concentration across types</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out rows where 'type' is blank or NA</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>bee_data <span class="ot">&lt;-</span> bee_data <span class="sc">%&gt;%</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(type) <span class="sc">&amp;</span> type <span class="sc">!=</span> <span class="st">""</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bee_data, <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">y =</span> sugar_concentration, <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Nectar Sugar Concentration by Plant Type"</span>,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Plant Type (Crop, Weed, Wild)"</span>,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Sugar Concentration (%)"</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"crop"</span> <span class="ot">=</span> <span class="st">"lightgreen"</span>, <span class="st">"weed"</span> <span class="ot">=</span> <span class="st">"tomato"</span>, <span class="st">"wild"</span> <span class="ot">=</span> <span class="st">"skyblue"</span>)) <span class="sc">+</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Preliminary-results_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Kruskal-Wallis Test: Test for differences among the three groups</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>kruskal_result <span class="ot">&lt;-</span> <span class="fu">kruskal.test</span>(sugar_concentration <span class="sc">~</span> type, <span class="at">data =</span> bee_data)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print Kruskal-Wallis results</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Kruskal-Wallis Test Results:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Kruskal-Wallis Test Results:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(kruskal_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Kruskal-Wallis rank sum test

data:  sugar_concentration by type
Kruskal-Wallis chi-squared = 15.78, df = 2, p-value = 0.0003745</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Dunn's Post-Hoc Test: Pairwise comparisons if Kruskal-Wallis is significant</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (kruskal_result<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>) {</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  dunn_result <span class="ot">&lt;-</span> <span class="fu">dunnTest</span>(sugar_concentration <span class="sc">~</span> type, <span class="at">data =</span> bee_data, <span class="at">method =</span> <span class="st">"bonferroni"</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Format the results for better display</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  dunn_result_df <span class="ot">&lt;-</span> dunn_result<span class="sc">$</span>res</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  dunn_result_df <span class="ot">&lt;-</span> dunn_result_df <span class="sc">%&gt;%</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Significance =</span> <span class="fu">ifelse</span>(P.adj <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">"Significant"</span>, <span class="st">"Not Significant"</span>))</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print pairwise results</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Dunn's Post-Hoc Test Results (Bonferroni Adjustment):</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(dunn_result_df)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">No significant differences found among the plant types.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Dunn's Post-Hoc Test Results (Bonferroni Adjustment):
   Comparison           Z      P.unadj        P.adj    Significance
1 crop - weed -2.04787489 0.0405722598 0.1217167793 Not Significant
2 crop - wild -3.72802714 0.0001929846 0.0005789538     Significant
3 weed - wild  0.02924117 0.9766722477 1.0000000000 Not Significant</code></pre>
</div>
</div>
</section>
<section id="phylogenetic-analysis-1" class="level4">
<h4 class="anchored" data-anchor-id="phylogenetic-analysis-1">7. Phylogenetic Analysis</h4>
<p>The phylogenetic analysis revealed critical patterns regarding the evolutionary relationships of nectar sugar concentration across plant families. A heatmap aligned with the phylogenetic tree highlights specific trends and deviations in sugar production strategies.</p>
<hr>
</section>
<section id="families-with-similar-nectar-sugar-concentrations" class="level4">
<h4 class="anchored" data-anchor-id="families-with-similar-nectar-sugar-concentrations"><strong>1. Families with Similar Nectar Sugar Concentrations</strong></h4>
<ul>
<li><p>Three families,&nbsp;<strong>Ranunculaceae, Costaceae, and Alstroemeriaceae</strong>, exhibit notable similarities in nectar sugar concentrations despite their phylogenetic distance.</p>
<ul>
<li><p>These families display moderate sugar concentrations (~40-50%), suggesting possible adaptations to generalist pollinators or similar environmental pressures.</p></li>
<li><p>The consistency across these families hints at&nbsp;<strong>convergent evolution</strong>&nbsp;for shared ecological strategies.</p></li>
</ul></li>
</ul>
<hr>
</section>
<section id="phylogenetic-signal-and-proximity" class="level4">
<h4 class="anchored" data-anchor-id="phylogenetic-signal-and-proximity"><strong>2. Phylogenetic Signal and Proximity</strong></h4>
<ul>
<li><p>Families that are phylogenetically&nbsp;<strong>closer</strong>&nbsp;often display clustering in nectar sugar concentrations.</p>
<ul>
<li><p>For example,&nbsp;<strong>Fabaceae</strong>&nbsp;and&nbsp;<strong>Rosaceae</strong>&nbsp;show moderate sugar values, reflecting potential shared evolutionary traits.</p></li>
<li><p>However, families like&nbsp;<strong>Ranunculaceae</strong>&nbsp;and&nbsp;<strong>Zygophyllaceae</strong>&nbsp;deviate from this trend, demonstrating significantly higher sugar concentrations despite their phylogenetic distance.</p></li>
<li><p>This decoupling indicates the presence of&nbsp;<strong>convergent evolution</strong>, where unrelated families adapt to similar ecological pressures (e.g., pollinator specialization).</p></li>
</ul></li>
</ul>
<hr>
</section>
<section id="variability-within-families" class="level4">
<h4 class="anchored" data-anchor-id="variability-within-families"><strong>3. Variability Within Families</strong></h4>
<ul>
<li><p>Certain families exhibit&nbsp;<strong>high variability</strong>&nbsp;in sugar concentrations across genera, suggesting diverse pollination strategies within the same family:</p>
<ul>
<li><p><strong>Solanaceae</strong>&nbsp;and&nbsp;<strong>Fabaceae</strong>&nbsp;show a wide range of sugar values, indicating adaptation to multiple pollinator types or environmental niches.</p></li>
<li><p>This variability reflects&nbsp;<strong>adaptive radiation</strong>, where genera exploit different ecological conditions to maximize reproductive success.</p></li>
</ul></li>
</ul>
<hr>
</section>
<section id="low-sugar-concentration-in-basal-angiosperms" class="level4">
<h4 class="anchored" data-anchor-id="low-sugar-concentration-in-basal-angiosperms"><strong>4. Low Sugar Concentration in Basal Angiosperms</strong></h4>
<ul>
<li><p>Basal families such as&nbsp;<strong>Magnoliaceae</strong>&nbsp;and&nbsp;<strong>Costaceae</strong>&nbsp;are positioned lower in the phylogenetic tree and exhibit lower to moderate sugar concentrations.</p>
<ul>
<li>This suggests that&nbsp;<strong>higher sugar concentrations</strong>&nbsp;may have evolved later in angiosperms, possibly alongside the evolution of more specialized pollination systems (e.g., hummingbirds and bats).</li>
</ul></li>
</ul>
<hr>
</section>
<section id="high-sugar-concentration-outliers" class="level4">
<h4 class="anchored" data-anchor-id="high-sugar-concentration-outliers"><strong>5. High Sugar Concentration Outliers</strong></h4>
<ul>
<li><p>Families such as&nbsp;<strong>Passifloraceae</strong>&nbsp;and&nbsp;<strong>Zygophyllaceae</strong>&nbsp;exhibit&nbsp;<strong>exceptionally high sugar concentrations</strong>&nbsp;(~60-65%) relative to other families:</p>
<ul>
<li><p>Despite being phylogenetically distant, these families appear to converge toward similar strategies, likely driven by selective pressures to attract high-energy-demand pollinators (e.g., hummingbirds, large insects).</p></li>
<li><p>This outlier behavior reinforces the role of&nbsp;<strong>ecological specialization</strong>&nbsp;over phylogenetic constraints in shaping nectar traits.</p></li>
</ul></li>
</ul>
<hr>
</section>
<section id="figure-legends" class="level3">
<h3 class="anchored" data-anchor-id="figure-legends"><strong>Figure Legends</strong>:</h3>
<ul>
<li><p><strong>Figure 10</strong>: Phylogenetic tree of families showing evolutionary relationships.</p></li>
<li><p><strong>Figure 11</strong>: Heatmap of nectar sugar concentrations aligned to the phylogenetic tree.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure sugar concentration is numeric and filter out blank Family names</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>bee_data <span class="ot">&lt;-</span> bee_data <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Family) <span class="sc">&amp;</span> Family <span class="sc">!=</span> <span class="st">""</span>, <span class="sc">!</span><span class="fu">is.na</span>(sugar_concentration)) <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sugar_concentration =</span> <span class="fu">as.numeric</span>(sugar_concentration))</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean sugar concentration for each unique family</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>mean_family_sugar <span class="ot">&lt;-</span> bee_data <span class="sc">%&gt;%</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Family) <span class="sc">%&gt;%</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_sugar_concentration =</span> <span class="fu">mean</span>(sugar_concentration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_sugar_concentration))</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: List of family names</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>family_names <span class="ot">&lt;-</span> <span class="fu">as.character</span>(mean_family_sugar<span class="sc">$</span>Family)  <span class="co"># Ensure 'Family' is character</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Match family names to Open Tree of Life identifiers</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>matched_names <span class="ot">&lt;-</span> <span class="fu">tnrs_match_names</span>(<span class="at">names =</span> family_names)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Filter out unmatched names (NA IDs)</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>valid_matches <span class="ot">&lt;-</span> matched_names <span class="sc">%&gt;%</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ott_id))  <span class="co"># Keep only valid IDs</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Generate the phylogenetic tree using valid IDs</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(valid_matches) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  tree <span class="ot">&lt;-</span> <span class="fu">tol_induced_subtree</span>(<span class="at">ott_ids =</span> valid_matches<span class="sc">$</span>ott_id)</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 5: Check and assign default branch lengths if missing</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(tree<span class="sc">$</span>edge.length)) {</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>    tree<span class="sc">$</span>edge.length <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(tree<span class="sc">$</span>edge))  <span class="co"># Assign equal branch lengths</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Shorten the branch lengths for better visualization</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtree</span>(tree, <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span>  <span class="co"># Reduce branch thickness</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tiplab</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">align =</span> <span class="cn">TRUE</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">linesize =</span> <span class="fl">0.5</span>) <span class="sc">+</span>  <span class="co"># Add tip labels</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Phylogenetic Tree of Families (Real Relationships)"</span>) <span class="sc">+</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_tree2</span>() <span class="sc">+</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">4.5</span>))  <span class="co"># Adjust X-axis space to fit labels</span></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Progress [---------------------------------] 0/150 (  0%) ?s
Progress [==============================] 150/150 (100%)  0s
                                                            </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Preliminary-results_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Extract the ordered family names manually from the tree</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>ordered_families <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Verbenaceae_ott1081077"</span>, <span class="st">"Lamiaceae_ott544714"</span>, <span class="st">"Bignoniaceae_ott900321"</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Oleaceae_ott23723"</span>, <span class="st">"mrcaott2108ott12524"</span>, <span class="st">"Apocynaceae_ott524059"</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Solanaceae_ott473827"</span>, <span class="st">"Caprifoliaceae_ott69534"</span>, <span class="st">"Araliaceae_ott524079"</span>,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Asteraceae_ott46248"</span>, <span class="st">"Polygonaceae_ott904376"</span>, <span class="st">"Nyctaginaceae_ott740464"</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Violaceae_ott224730"</span>, <span class="st">"Passifloraceae_ott530187"</span>, <span class="st">"Linaceae_ott1000257"</span>,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Fabaceae_ott560323"</span>, <span class="st">"Rosales_ott208031"</span>, <span class="st">"Zygophyllaceae_ott461732"</span>,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Malvaceae_ott279960"</span>, <span class="st">"Brassicaceae_ott309271"</span>, <span class="st">"mrcaott960tt1860"</span>,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Onagraceae_ott1015483"</span>, <span class="st">"Vitaceae_ott1069308"</span>, <span class="st">"Grossulariaceae_ott488526"</span>,</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Berberidaceae_ott297866"</span>, <span class="st">"Ranunculaceae_ott387826"</span>, <span class="st">"Amaryllidaceae_ott17701"</span>,</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Costaceae_ott679527"</span>, <span class="st">"Alstroemeriaceae_ott940129"</span>, <span class="st">"Magnoliaceae_ott288464"</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Match family names in ordered_families with closest names in mean_family_sugar</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>matched_names <span class="ot">&lt;-</span> <span class="fu">sapply</span>(ordered_families, <span class="cf">function</span>(tree_name) {</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  closest_match <span class="ot">&lt;-</span> mean_family_sugar<span class="sc">$</span>Family[<span class="fu">which.min</span>(</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    stringdist<span class="sc">::</span><span class="fu">stringdist</span>(tree_name, mean_family_sugar<span class="sc">$</span>Family)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  )]</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(closest_match)</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Create a new table with matched names and sugar concentrations</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>heatmap_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tree_Family =</span> ordered_families,       <span class="co"># Tree order</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">Matched_Family =</span> matched_names        <span class="co"># Closest names from mean_family_sugar</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with sugar concentrations</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>heatmap_data <span class="ot">&lt;-</span> heatmap_data <span class="sc">%&gt;%</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mean_family_sugar, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Matched_Family"</span> <span class="ot">=</span> <span class="st">"Family"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Tree_Family =</span> <span class="fu">factor</span>(Tree_Family, <span class="at">levels =</span> ordered_families)) <span class="sc">%&gt;%</span></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Tree_Family, mean_sugar_concentration)</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Plot the heatmap and reverse the Y-axis order</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(heatmap_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> Tree_Family, <span class="at">fill =</span> mean_sugar_concentration)) <span class="sc">+</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"yellow"</span>, <span class="at">high =</span> <span class="st">"red"</span>, <span class="at">name =</span> <span class="st">"Sugar Conc."</span>) <span class="sc">+</span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">limits =</span> <span class="fu">rev</span>(<span class="fu">levels</span>(heatmap_data<span class="sc">$</span>Tree_Family))) <span class="sc">+</span>  <span class="co"># Reverse the Y-axis order</span></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Heatmap of Sugar Concentration by Family (Tree Order)"</span>, </span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Family"</span>) <span class="sc">+</span></span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))  <span class="co"># Adjust text size for readability</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Preliminary-results_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<pre><code></code></pre>
</section>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section"></h3>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>